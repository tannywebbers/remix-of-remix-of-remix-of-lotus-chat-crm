/* ADD THESE RULES TO YOUR EXISTING index.css */

/* ===== SECTION 4: BUBBLE GEOMETRY REFINEMENT ===== */

/* Precise corner radii for iOS WhatsApp style */
.message-bubble {
  border-radius: 14px;
  position: relative;
}

.message-bubble-outgoing {
  border-top-left-radius: 14px;
  border-top-right-radius: 14px !important;
  border-bottom-left-radius: 14px;
  border-bottom-right-radius: 6px;
}

.message-bubble-incoming {
  border-top-left-radius: 14px !important;
  border-top-right-radius: 14px;
  border-bottom-left-radius: 6px;
  border-bottom-right-radius: 14px;
}

.message-bubble-outgoing::after,
.message-bubble-incoming::after {
  content: '';
  position: absolute;
  width: 10px;
  height: 10px;
  bottom: 2px;
}

.message-bubble-outgoing::after {
  right: -4px;
  background: hsl(var(--bubble-outgoing));
  clip-path: polygon(0 100%, 100% 100%, 100% 0);
}

.message-bubble-incoming::after {
  left: -4px;
  background: hsl(var(--bubble-incoming));
  clip-path: polygon(0 0, 0 100%, 100% 100%);
}

/* MESSAGE SPACING HIERARCHY */

/* Base spacing between messages from same sender - 4px */
.space-y-2 > div + div {
  margin-top: 4px;
}

/* Group separation when messages cluster - 10px */
/* Applied automatically when there's a 5+ minute gap */
.message-group-separator {
  margin-top: 10px !important;
}

/* Different sender separation - 14px */
.space-y-2 > .flex.justify-end + .flex.justify-start,
.space-y-2 > .flex.justify-start + .flex.justify-end {
  margin-top: 14px !important;
}

/* Bubble to avatar spacing (if you show avatars) - 8px */
.message-with-avatar {
  padding-left: 8px;
}

/* ===== VOICE RECORDING UI ===== */

/* Recording indicator animation */
@keyframes recording-pulse {
  0%, 100% { 
    opacity: 1;
    transform: scale(1);
  }
  50% { 
    opacity: 0.5;
    transform: scale(1.2);
  }
}

.recording-indicator {
  animation: recording-pulse 1s ease-in-out infinite;
}

/* ===== SMOOTH TRANSITIONS ===== */

.message-bubble,
.message-bubble-incoming,
.message-bubble-outgoing {
  transition: all 0.15s ease-out;
}

/* ===== TIMESTAMP SPACING ===== */

/* More breathing room between message content and timestamp */
.message-bubble > div:last-child {
  margin-top: 8px; /* Space above timestamp row */
}

/* ===== MEDIA MESSAGE ADJUSTMENTS ===== */

/* Images, videos should maintain bubble geometry */
.message-bubble img,
.message-bubble video {
  border-radius: inherit;
  max-width: 100%;
}

/* Audio player in bubble */
.message-bubble audio {
  max-width: 100%;
}

/* ===== VISUAL GROUPING ===== */

/* Clear visual separation between conversation flows */
.conversation-day-separator {
  margin: 20px 0;
  text-align: center;
}

.conversation-day-separator span {
  display: inline-block;
  padding: 4px 12px;
  background: hsl(var(--muted));
  border-radius: 12px;
  font-size: 12px;
  color: hsl(var(--muted-foreground));
  font-weight: 500;
}

/* ===== MOBILE OPTIMIZATIONS ===== */

@media (max-width: 640px) {
  .message-bubble {
    max-width: 85%; /* Slightly wider on mobile */
  }
  
  /* Ensure tap targets are big enough */
  .message-bubble-incoming,
  .message-bubble-outgoing {
    min-height: 36px;
    padding: 6px 10px;
  }
}

/* ===== ACCESSIBILITY ===== */

/* Focus indicators for keyboard navigation */
.message-bubble:focus-visible {
  outline: 2px solid hsl(var(--ring));
  outline-offset: 2px;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .message-bubble-outgoing {
    border: 1px solid hsl(var(--border));
  }
  
  .message-bubble-incoming {
    border: 1px solid hsl(var(--border));
  }
}

/* ===== REDUCE MOTION ===== */

@media (prefers-reduced-motion: reduce) {
  .message-bubble,
  .recording-indicator {
    animation: none;
    transition: none;
  }
}
